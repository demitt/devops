---
- name: Add Certbot repository
  # requires: python-apt (python 2) or python3-apt (python 3)
  apt_repository:
    repo: ppa:certbot/certbot
    state: present
    update_cache: true

- name: Setup Certbot
  apt: 
    name: python-certbot-nginx
    state: present

#- name: Gererate certificate
#  acme_certificate:
    # TODO
    # requires: python >= 2.6; either openssl or cryptography >= 1.5
    ### sudo certbot --nginx -d myserver.com -d www.myserver.com
    # TODO: move "myserver.com" to variables

- name: Setup Nginx
  apt: 
    name: nginx
    state: present

- name: Copy Nginx config
  template:
    src: "{{ role_path }}/templates/nginx.conf.j2"
    dest: /etc/nginx/sites-available/default
    # TODO: add permissions for file? (user? user & group?)

- name: Create Nginx folder for static content
  file:
    path: /var/www/html/static
    state: directory
    mode: 0775

- name: Test Nginx config
  shell: "nginx -t"
  register: nginxConfigStatus

- debug: msg="{{ nginxConfigStatus.stdout_lines }}"

- name: Restart Nginx
  service:
    name: nginx
    state: restarted
